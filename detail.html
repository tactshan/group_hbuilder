<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" href="bootstrap/css/bootstrap.css">
	</head>

	<body>
		<script src="js/mui.js"></script>
		<script type="text/javascript">
			mui.init()
		</script>
		<table class="table table-bordered">
			<h1 align="center">商品详情</h1>
			<input type="hidden" id="goods_id">
			<input type="hidden" id="uid">
			<input type="hidden" id="token">
			<input type="hidden" id="goods_type">
			<tr>
				<td>商品名称：</td>
				<td id="goods_name"></td>
			</tr>
			<tr>
				<td>商品价格：</td>
				<td id="goods_price"></td>
			</tr>
			<tr>
				<td>购买数量：</td>
				<td ><input type="text" style="width: 40px;" id="buy_num"></td>
			</tr>
			<tr>
				<td>访问量：</td>
				<td id="access"></td>
			</tr>
			<tr>
				<td>热度：</td>
				<td id="like_num"></td>
			</tr>
			<tr>
				<td><button onclick="give_like()" id="give_a_like" style="background-color:white;">点赞</button>&nbsp;
				<button style="background-color: white;" id="collect" onclick="collect()" type="1">收藏</button></td>
				<td><button onclick="addCart()" id="addcart">加入购物车</button></td>
			</tr>
		</table>
	</body>

</html>
<script src="js/jquery-3.2.1.min.js"></script>
<script src="bootstrap/js/bootstrap.js"></script>
<script type="text/javascript">
	$(function(){
		_url=window.location.href
		var goods_id_place=_url.lastIndexOf("_id=");
		var goods_id_last_place=_url.lastIndexOf("&u");
		var goods_id=_url.substring(goods_id_place+4,goods_id_last_place)
		var uid_place=_url.lastIndexOf("uid=");
		var uid_last_place=_url.lastIndexOf("&t")
		var uid=_url.substring(uid_place+4,uid_last_place)
		var token_place=_url.lastIndexOf("n=")
		var token=_url.substring(token_place+2,_url.length)
		
		$("#goods_id").val(goods_id)
		$("#uid").val(uid)
		$("#token").val(token)
		
		
	
		mui.ajax('http://group_shop.tactshan.com/group_shop/goods_detail',{
			data:{
				goods_id : goods_id,
				uid : uid,
				token : token 
			},
			dataType:'json',//服务器返回json格式数据
			type:'post',//HTTP请求类型
			timeout:10000,//超时时间设置为10秒；
			success:function(data){
				var goods_name = $("#goods_name").html(data.goods_name)
				var goods_price = $("#goods_price").html(data.goods_price)
				var goods_num = $("#goods_num").html(data.goods_num)
				var access=$("#access").html(data.access_num);
				var like_num=$("#like_num").html(data.like_num);
				var goods_type=$("#goods_type").val(data.goods_type);
			}
		});
		var goods_type_num = $("#goods_type").val();
		if(goods_type_num==1){
			$("#collect").css('background-color',' #A94442')
			$("#collect").text("已收藏")
		}else{
			$("#collect").css('background-color','white')
			$("#collect").text("收藏")
		}
	})
	function addCart(){
		var buy_num = $("#buy_num").val()
		var goods_id= $("#goods_id").val();
		var uid = $("#uid").val();
		var token= $("#token").val();
		var goods_price= $("#goods_price").text();
		var total_price = goods_price*buy_num;
		if(buy_num==''){
			alert('购买数量必填')
			return false
		}
		mui.ajax('http://group_shop.tactshan.com/cart/addcart',{
			data:{
				buy_num : buy_num,
				goods_id:goods_id,
				uid:uid,
				token:token,
				total_price:total_price
			},
			dataType:'json',//服务器返回json格式数据
			type:'post',//HTTP请求类型
			timeout:10000,//超时时间设置为10秒；
			success:function(data){
				if(data.code==0){
					var url='./cart.html?uid='+uid+'&token='+token
					location.href=url;	
				}else if(data.code==40001){
					location.href="./login.html"
				}
			}
		});
	}
	
	function give_like(){
		var goods_id= $("#goods_id").val();
		var uid = $("#uid").val();
		var token= $("#token").val();
		var type=$("#give_a_like").attr("type");
		mui.ajax('http://group_shop.tactshan.com/give_a_like',{
			data:{
				goods_id:goods_id,
				uid:uid,
				token:token,
			},
			dataType:'json',//服务器返回json格式数据
			type:'post',//HTTP请求类型
			timeout:10000,//超时时间设置为10秒；
			success:function(data){
				alert(data.msg)
				if(data.code==40001){
					location.href="./login.html"
				}else if(data.code==0){
					if(type==1){
						$("#give_a_like").css('background-color',' #A94442')
						$("#give_a_like").attr("type","2");
						$("#give_a_like").text("已赞")
					}
				}else if(data.code==50060){
					$("#give_a_like").css('background-color',' #A94442')
					$("#give_a_like").text("已赞")
				}
				
			},
			error:function(xhr,type,errorThrown){
				alert(0)
			}
		});
	}
	
	
	

	function collect(){
		var goods_id= $("#goods_id").val();
		var uid = $("#uid").val();
		var token= $("#token").val();
		var goods_type_num = $("#goods_type").val();
		if(goods_type_num==0){
			$("#collect").css('background-color',' #A94442')
			$("#collect").text("已收藏")
		}else{
			$("#collect").css('background-color','white')
			$("#collect").text("收藏")
		}
		mui.ajax('http://group_shop.tactshan.com/collect',{
			data:{
				goods_id:goods_id,
				uid:uid,
				token:token
			},
			dataType:'json',//服务器返回json格式数据
			type:'post',//HTTP请求类型
			timeout:10000,//超时时间设置为10秒；
			success:function(data){
				alert(data.msg)
			},
			error:function(xhr,type,errorThrown){
				
			}
		});
	}
</script>
